description: Runs create-typescript-app in transition mode

name: Transition

inputs:
  token:
    description: The GitHub token to use for the PR
    required: true

runs:
  steps:
    - uses: ./.github/actions/prepare
    - id: auto-commit-action
      uses: stefanzweifel/git-auto-commit-action@778341af668090896ca464160c2def5d1d1a3eb0 # v6
      with:
        commit_author: The Friendly Bingo Bot <bot@create.bingo>
        commit_message: Check in changes from re-running npx create-typescript-app
        commit_user_email: bot@create.bingo
        commit_user_name: The Friendly Bingo Bot
    - id: package-change
      uses: JoshuaKGoldberg/package-change-detector-action@2e72423586ed69fa6ceeef73f41532d44d7f2b60
      with:
        properties: engines
    - if: steps.package-change.outputs.changed == 'true'
      uses: JoshuaKGoldberg/draft-pull-request-once-action@a512791e242fca9ad9c6c8de890410aee23e14c3
      with:
        github-token: ${{ inputs.token }}
        message: |
          🤖 Beep boop! This PR changes the `engines` field in `package.json`. It's been set to a draft so that it doesn't automatically merge. Go ahead and un-draft the PR if you're ok with the breaking change.

          Cheers!
          _— The Friendly Bingo Bot 💝_
  using: composite
